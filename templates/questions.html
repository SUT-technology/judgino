<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحه اصلی</title>
    <link rel="stylesheet" href="/static/css/lib/daisyui.min.css">
    <script src="/static/js/lib/tailwind.min.js"></script>
    <script src="/static/js/config.js"></script>
    <link rel='stylesheet' href='/static/css/lib/uicons-regular-rounded.css'>
    <link rel='stylesheet' href='/static/css/lib/uicons-solid-rounded.css'>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>

    <header>
        <button class="pr-4 pt-5 lg:hidden" onclick="handlemenu()"><i
                    class="fi fi-sr-bars-staggered text-2xl"></i></button>
        <div id="backdrop-menu" onclick="handlemenu()"
             class="fixed top-0 right-0 bg-black bg-opacity-50 w-screen h-screen lg:hidden hidden z-10"></div>
        <nav class="bg-gray-20 bg-opacity-45 backdrop-blur-3xl p-3 lg:w-2/12 w-1/2 h-[90vh] fixed lg:right-0 right-[-100%] top-[5%] rounded-l-2xl shadow-lg transition-all duration-300 z-20"
             id="menu">
            <div class="text-center font-fedra text-2xl mt-5">
                judgino
            </div>
            <ul class="menu rounded-box mt-20">
                <li class="mb-3">
                    <a href="#">
                        <i class="fi fi-rr-home"></i>
                        سوال ها
                    </a>
                </li>
                <li class="mb-3 bg-gray-38 rounded-lg">
                    <a href="#">
                        <i class="fi fi-rr-edit"></i>
                        سوال جدید
                    </a>
                </li>
                <li class="mb-3">
                    <a href="#">
                        <i class="fi fi-rr-checkbox"></i>
                        ارسال ها
                    </a>
                </li>
                </li>
                <li class="mb-3">
                    <a href="/pages/player/scores.html">
                        <i class="fi fi-rr-user"></i>
                        پروفایل
                    </a>
                </li>
                <li class="mb-3">
                    <a href="/pages/player/questions.html">
                        <i class="fi fi-rr-user-pen"></i>
                        ویرایش پروفایل
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <div class="lg:w-10/12 p-3 mr-auto mt-6">
        <section class="bg-gray-20 bg-opacity-45 min-h-full backdrop-blur-3xl p-3 rounded-2xl w-full min-h-[90h] z-20">
            <div class="card lg:w-8/12 w-10/12  mx-auto bg-gray-700 bg-opacity-30 backdrop-blur-xl p-4 rounded-xl">
            
                <h1 class="text-4xl text-center font-fedra mb-5">لیست سوالات</h1>

        <!-- Filter Input -->
        <div class="mb-4">
            <input type="text" id="searchFilter" placeholder="جستجوی سوالات..." class="p-2 w-full rounded-md border mb-4">
            <select id="questionFilter" class="p-2 w-1/4 rounded-md border">
                <option value="all">تمام سوالات</option>
                <option value="mine">سوالات من</option>
            </select>
            <select id="sortFilter" class="p-2 w-1/4 rounded-md border">
                <option value="publish_date">به ترتیب تاریخ انتشار</option>
                <option value="deadline">به ترتیب مهلت</option>
            </select>
        </div>

        <div class="overflow-x-auto w-3/4 mx-auto bg-base--gray rounded-xl table-con bg-opacity-75">
            <table class="table-auto w-full text-center border-collapse">
                <thead>
                    <tr>
                        <th class="2">عنوان</th>
                        <th class="2">تاریخ انتشار</th>
                        <th class="2">مهلت</th>
                    </tr>
                </thead>
                <tbody id="questions-list">
                    {{range .Questions}}
                        <tr>
                            <td class="2">{{.Title}}</td>
                            <td class="2">{{.PublishDate}}</td>
                            <td class="2">{{.Deadline}}</td>
                        </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        <div class="flex justify-center items-center mt-4">
            <button id="prevPage" class="p-2 bg-gray-500 text-white rounded-md">قبلی</button>
            <span id="pageInfo" class="mx-6"></span>
            <button id="nextPage" class="p-2 bg-gray-500 text-white rounded-md">بعدی</button>
        </div>
            
            </div>
        </section>
    </div>

    <script>
        // When the input or select options change, trigger a request to the backend
        const searchFilter = document.getElementById('searchFilter');
        const questionFilter = document.getElementById('questionFilter');
        const sortFilter = document.getElementById('sortFilter');


        const   prevPageBtn = document.getElementById('prevPage');
        const   nextPageBtn = document.getElementById('nextPage');
        const   pageInfo = document.getElementById('pageInfo');

        let currentPage = 1;  // Track the current page
        let totalPages = 5;   // Total pages, needs to be set after the first request
        pageInfo.textContent = `صفحه ${currentPage} از ${totalPages}`;



        // When input or select options change, trigger a request to the backend
        searchFilter.addEventListener('input', handlePaginationChange);
        questionFilter.addEventListener('change', handlePaginationChange);
        sortFilter.addEventListener('change', handlePaginationChange);

        // "Previous" button click
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                handlePaginationChange();
            }
        });

        // "Next" button click
        nextPageBtn.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                handlePaginationChange();
            }
        });

        searchFilter.addEventListener('input', () => {
            const searchValue = searchFilter.value;
            const questionValue = questionFilter.value;
            const sortValue = sortFilter.value;

            // Send data to the backend via GET request
            const queryString = `searchValue=${searchValue}&questionValue=${questionValue}&sortValue=${sortValue}&page=${currentPage}`;
            fetch(`/questions?${queryString}`)
                .then(response => response.json())
                .then(data => {
                    console.log(data); // Handle the response
                    updateQuestionsList(data);
            })
            .catch(error => console.error('Error:', error));
        });


        // Function to handle the request to the backend with current page and filter values
        function handlePaginationChange() {
            const searchValue = searchFilter.value;
            const questionValue = questionFilter.value;
            const sortValue = sortFilter.value;

            const queryString = `searchValue=${searchValue}&questionValue=${questionValue}&sortValue=${sortValue}&page=${currentPage}`;

            // Send the data to the backend
            fetch(`/questions?${queryString}`)
                .then(response => response.json())
                .then(data => {
                    console.log(data); // Handle the response
                    updateQuestionsList(data);
                })
                .catch(error => console.error('Error:', error));
        }

        // Function to update the questions list and pagination information
        function updateQuestionsList(data) {
            const questionsList = document.getElementById('questions-list');
            questionsList.innerHTML = ''; // Clear existing questions

            data.questions.forEach(question => {
                const publishDate = new Date(question.publish_date);
                const deadlineDate = new Date(question.deadline);

                // Check if the dates are valid
                const validPublishDate = !isNaN(publishDate) ? publishDate.toLocaleDateString() : 'Invalid Date';
                const validDeadlineDate = !isNaN(deadlineDate) ? deadlineDate.toLocaleDateString() : 'Invalid Date';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="2">${question.title}</td>
                    <td class="2">${validPublishDate}</td>
                    <td class="2">${validDeadlineDate}</td>
                `;
                questionsList.appendChild(row);
            });

            // Update the pagination info
            totalPages = data.totalPages;  // Update the total pages from the response
            pageInfo.textContent = `صفحه ${currentPage} از ${totalPages}`;

            // Disable/enable pagination buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            handlePaginationChange();
        }
    </script>
    <script src="/static/js/main.js"></script>
</body>

</html>